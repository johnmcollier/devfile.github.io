<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Adding kubernetes component to a devfile :: Devfile Documentation</title>
    <link rel="canonical" href="https://docs.devfile.io/devfile/user-guide/adding-kubernetes-component-to-a-devfile.html">
    <meta name="description" content="Adding kubernetes component to a devfile">
    <meta name="keywords" content="authoring, stack, components">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="stylesheet" href="../../_/css/extra.css">
<link rel="stylesheet" href="../../_/font-awesome-4.7.0/css/font-awesome.min.css">
<link rel="icon" href="../../favicon.ico" type="image/x-icon">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <button class="navbar-burger" data-target="topbar-nav">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <img src="../../_/img/devfile-logo.png" class="navbar-logo" alt="Devfile logo">
        <a href="https://devfile.github.io">Devfile // Docs</a>
      </div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
      </div>
    </div>
  </nav>
<div class="gcse-searchresults"></div>
</header>
<div class="body">
<div class="nav-container" data-component="devfile" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Devfile User Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="authoring-stacks.html">Authoring stacks</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="adding-schema-version-to-a-devfile.html">Adding schema version</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="adding-a-name-to-a-devfile.html">Adding a name</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="adding-projects-to-a-devfile.html">Adding projects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="adding-commands-to-a-devfile.html">Adding commands</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="adding-components-to-a-devfile.html">Adding components</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adding-plugin-component-to-a-devfile.html">Adding plugin component</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="adding-kubernetes-component-to-a-devfile.html">Adding kubernetes component</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adding-container-component-to-a-devfile.html">Adding container component</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="specifying-persistent-storage.html">Specifying persistent storage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="limiting-resources-usage.html">Limiting resources usage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="defining-environment-variables.html">Defining environment variables</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="defining-endpoints.html">Defining endpoints</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="defining-kubernetes-resources.html">Defining Kubernetes resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="adding-attributes-to-a-devfile.html">Adding attributes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="adding-event-bindings.html">Adding event bindings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="refering-to-a-parent-devfile-in-a-devfile.html">Refering to a parent</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="migrating-to-devfile-v2.html">Migrating to devfile v2</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="migrating-schema-version.html">Migrating schema version</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="migrating-projects.html">Migrating projects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="migrating-components.html">Migrating components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="migrating-plug-ins.html">Migrating plug-ins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="migrating-commands.html">Migrating commands</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="adding-event-bindings.html">Adding event bindings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="refering-to-a-parent-devfile-in-a-devfile.html">Refering to a parent</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="api-reference.html">API reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="devfile-samples.html">Devfile samples</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Devfile User Guide</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Devfile User Guide</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Devfile User Guide</a></li>
    <li><a href="authoring-stacks.html">Authoring stacks</a></li>
    <li><a href="adding-components-to-a-devfile.html">Adding components</a></li>
    <li><a href="adding-kubernetes-component-to-a-devfile.html">Adding kubernetes component</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/devfile/docs/edit/master/docs/modules/user-guide/pages/adding-kubernetes-component-to-a-devfile.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Adding <code>kubernetes</code> component to a devfile</h1>
<div class="paragraph _abstract">
<p>This section describes how to add a <code>kubernetes</code> component to a devfile. A complex component type that allows to apply configuration from a list of Kubernetes or OpenShift components.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="adding-schema-version-to-a-devfile.html" class="page">Adding schema version to a devfile</a></p>
</li>
<li>
<p><a href="adding-a-name-to-a-devfile.html" class="page">Adding a name to a devfile</a></p>
</li>
<li>
<p><a href="adding-components-to-a-devfile.html" class="page">Adding components to a devfile</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Define a component using the type <code>kubernetes</code>.</p>
</li>
<li>
<p>The content can be provided through the <code>reference</code> attribute, which points to the file with the component content.</p>
<div class="exampleblock">
<div class="title">Example 1. Adding <code>kubernetes</code> component using the <code>reference</code> attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  components:
    - name: mysql
      kubernetes:
        reference: petclinic.yaml
        selector:
          app.kubernetes.io/name: mysql
          app.kubernetes.io/component: database
          app.kubernetes.io/part-of: petclinic</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Alternatively, to post a devfile with such components to REST API, the contents of the Kubernetes or OpenShift list can be embedded into the devfile using the <code>referenceContent</code> field:</p>
<div class="exampleblock">
<div class="title">Example 2. Adding <code>kubernetes</code> component using the <code>referenceContent</code> attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  components:
    - name: mysql
      kubernetes:
        reference: petclinic.yaml
        referenceContent: |
             kind: List
             items:
              -
               apiVersion: v1
               kind: Pod
               metadata:
                name: ws
               spec:
                containers:
               ... etc</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Overriding container entrypoints. As with the <a href="#component-type-containerdevfile"><code>container</code> component</a>, it is possible to override the entrypoint of the containers contained in the Kubernetes or OpenShift list using the <code>command</code> and <code>args</code> properties (as <a href="https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/#notes">understood</a> by Kubernetes).</p>
<div class="paragraph">
<p>There can be more containers in the list (contained in Pods or Pod templates of deployments). It is therefore necessary to select which containers to apply the entrypoint changes to as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. Overriding container entrypoints</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  components:
    - name: appDeployment
      kubernetes:
        reference: app-deployment.yaml
        entrypoints:
        - parentName: mysqlServer
          command: ['sleep']
          args: ['infinity']
        - parentSelector:
          app: prometheus
          args: ['-f', '/opt/app/prometheus-config.yaml']</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>entrypoints</code> list contains constraints for picking the containers along with the <code>command</code> and <code>args</code> parameters to apply to them. In the example above, the constraint is <code>parentName: mysqlServer</code>, which will cause the command to be applied to all containers defined in any parent object called <code>mysqlServer</code>. The parent object is assumed to be a top level object in the list defined in the referenced file, which is <code>app-deployment.yaml</code> in the example above.</p>
</div>
<div class="paragraph">
<p>Other types of constraints (and their combinations) are possible:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>containerName</code></dt>
<dd>
<p>the name of the container</p>
</dd>
<dt class="hdlist1"><code>parentName</code></dt>
<dd>
<p>the name of the parent object that (indirectly) contains the containers to override</p>
</dd>
<dt class="hdlist1"><code>parentSelector</code></dt>
<dd>
<p>the set of labels the parent object needs to have</p>
<div class="paragraph">
<p>A combination of these constraints can be used to precisely locate the containers inside the referenced Kubernetes list.</p>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Overriding container environment variables</p>
<div class="paragraph">
<p>To provision or override entrypoints in a Kubernetes or OpensShift component, configure it in the following way:</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Overriding container environment variables</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  components:
    - name: appDeployment
      kubernetes:
        reference: app-deployment.yaml
        env:
          - name: ENV_VAR
            value: value</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This is useful for temporary content or without access to editing the referenced content. The specified environment variables are provisioned into each init container and containers inside all Pods and Deployments.</p>
</div>
</li>
<li>
<p>Specifying mount-source option</p>
<div class="paragraph">
<p>To specify a project sources directory mount into container(s), use the <code>mountSources</code> parameter:</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Specifying mount-source option</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">   components:
      - name: appDeployment
        kubernetes:
          reference: app-deployment.yaml
          mountSources: true</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If enabled, project sources mounts will be applied to every container of the given component.
This parameter is also applicable for <code>plugin</code> type components.</p>
</div>
</li>
</ol>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
